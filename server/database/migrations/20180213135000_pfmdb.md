
// exports.up = function(knex) {
//   return createUsersTable(knex)
//     .then(createPatientsTable)
//     .then(createVitalSignsTable)
//     .then(createProceduralsTable)
//     .then(createDischargesTable)
//     .then(createPatientVitalSignTable)
//     .then(createPatientProceduralTable)
//     .then(createPatientDischargeTable)
//     .catch(error => {
//       console.log(error);
//       reject(error);
//     });  
// };

exports.up = function(knex) {
  return createPatientsTable(knex)
    .then(createVitalSignsTable) 
    .catch(error => {
      console.log(error);
      reject(error);
    });
};

exports.down = function(knex) {
  return knex.schema
    .dropTableIfExists('vitalSigns')
    .then(function() {
      console.log('dropping Patients');
      return knex.schema.dropTableIfExists('patients');
    })
    .catch(error => console.log(error));
};

// exports.down = function(knex) {
//   return knex.schema
//     .dropTableIfExists('patientdischarge')
//     .then(function() {
//       console.log('dropping PatientProcedural');
//       return knex.schema.dropTableIfExists('patientprocedural');
//     })
//     .then(function() {
//       console.log('dropping PatientVitalSign');
//       return knex.schema.dropTableIfExists('patientvitalSign');
//     })
//     .then(function() {
//       console.log('dropping Discharges');
//       return knex.schema.dropTableIfExists('discharges');
//     })
//     .then(function() {
//       console.log('dropping Procedurals');
//       return knex.schema.dropTableIfExists('procedurals');
//     })
//     .then(function() {
//       console.log('dropping VitalSigns');
//       return knex.schema.dropTableIfExists('vitalSigns');
//     })
//     .then(function() {
//       console.log('dropping Patients');
//       return knex.schema.dropTableIfExists('patients');
//     })
//     .then(function() {
//       console.log('dropping Users');
//       return knex.schema.dropTableIfExists('users');
//     })
//     .catch(error => console.log(error));
// };

// function createUsersTable(knex) {
//   console.log('creating users table');

//   return new Promise(function(resolve, reject) {
//     knex.schema
//       .createTable('users', function(users) {
//         users.increments('id');
//         users.string('email', 255).notNullable().unique();
//         users.string('password', 128).notNullable();
//         users.boolean('activated');
//         users.timestamp('createAt').defaultTo(knex.fn.now());

//         console.log('users table created');
//         resolve(knex);
//       })
//       .catch(error => reject(error));
//   })
// }

function createPatientsTable(knex) {
  console.log('creating patients table');

  return new Promise(function(resolve, reject) {
    knex.schema
      .createTable('patients', function(patients) {
        patients.increments('id').primary();
        patients.string('firstname', 128).notNullable();
        patients.string('lastname', 128).notNullable();
        patients.date('DOB').notNullable();
        patients.string('gender', 128);
        patients.timestamp('createAt').defaultTo(knex.fn.now()); 
        
        console.log('patients table created');
        resolve(knex);
      })
      .catch(error => reject(error));
  })
}

function createVitalSignsTable(knex) {
  console.log('creating vitalSigns table');

  return new Promise(function(resolve, reject) {
    knex.schema
      .createTable('vitalSigns', function(vitalSigns) {
        vitalSigns.increments('id').primary();
        vitalSigns.decimal('temperature', 4, 1);
        vitalSigns.integer('heart_rate');
        vitalSigns.integer('systolic');
        vitalSigns.integer('diastolic');
        vitalSigns.date('test_date');
        vitalSigns
          .foreign('patient')
          .references('id')
          .inTable('patients')
          .onDelete('CASCADE')
          .onUpdate('RESTRICT')
          .index();
        vitalSigns.timestamp('createAt').defaultTo(knex.fn.now());

        console.log('vitalSigns table created');
        resolve(knex);
      })
      .catch(error => reject(error));
  })
} 

// function createProceduralsTable(knex) {
//   console.log('creating procedurals table');

//   return new Promise(function(resolve, reject) {
//     knex.schema
//       .createTable('procedurals', function(procedurals) {
//         procedurals.increments('id').primary();
//         procedurals.date('procedural_date');
//         procedurals.text('procedural_note', 'longtext');
//         procedurals.string('Dr_name', 128);
//         procedurals.timestamp('createAt').defaultTo(knex.fn.now());

//         console.log('procedurals table created');
//         resolve(knex);
//       })
//       .catch(error => reject(error));
//   })
// }

// function createDischargesTable(knex) {
//   console.log('creating discharges table');

//   return new Promise(function(resolve, reject) {
//     knex.schema
//       .createTable('discharges', function(discharges) {
//         discharges.increments('id').primary();
//         discharges.text('discharge_to', 'mediumtext');
//         discharges.date('discharge_date');
//         discharges.timestamp('createAt').defaultTo(knex.fn.now());

//         console.log('discharges table created');
//         resolve(knex);
//       })
//       .catch(error => reject(error));
//   })
// }

// function createPatientVitalSignTable(knex) {
//   console.log('creating patientvitalSign table');

//   return new Promise(function(resolve, reject) {
//     knex.schema
//       .createTable('patientvitalSign', function(patientvitalSign) {
//         patientvitalSign.increments('id');
//         patientvitalSign
//           .increments('patientId')
//           .unsigned()
//           .notNullable()
//           .references('id')
//           .inTable('patients');
//         patientvitalSign
//           .increments('vitalSignId')
//           .unsigned()
//           .notNullable()
//           .references('id')
//           .inTable('vitalSign');

//         console.log('patientvitalSign table created');
//         resolve(knex);
//       })
//       .catch(error => reject(error));
//   });
// }

// function createPatientProceduralTable(knex) {
//   console.log('creating patientprocedural table');

//   return new Promise(function(resolve, reject) {
//     knex.schema
//       .createTable('patientprocedural', function(patientprocedural) {
//         patientprocedural.increments('id');
//         patientprocedural
//           .increments('patientId')
//           .unsigned()
//           .notNullable()
//           .references('id')
//           .inTable('patients');
//           patientprocedural
//           .increments('proceduralId')
//           .unsigned()
//           .notNullable()
//           .references('id')
//           .inTable('procedural');

//         console.log('patientprocedural table created');
//         resolve(knex);
//       })
//       .catch(error => reject(error));
//   });
// }

// function createPatientDischargeTable(knex) {
//   console.log('creating patientdischarge table');

//   return new Promise(function(resolve, reject) {
//     knex.schema
//       .createTable('patientdischarge', function(patientdischarge) {
//         patientdischarge.increments('id');
//         patientdischarge
//           .increments('patientId')
//           .unsigned()
//           .notNullable()
//           .references('id')
//           .inTable('patients');
//           patientdischarge
//           .increments('dischargeId')
//           .unsigned()
//           .notNullable()
//           .references('id')
//           .inTable('discharge');

//         console.log('patientdischarge table created');
//         resolve(knex);
//       })
//       .catch(error => reject(error));
//   });
// }
